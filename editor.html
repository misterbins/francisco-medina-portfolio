<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Francisco Medina - Editor Auto-Sync</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        .editor-field {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 12px;
            transition: border-color 0.3s ease;
        }
        .editor-field:focus {
            border-color: #3b82f6;
            outline: none;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .saving {
            animation: pulse 2s infinite;
        }
        .success {
            background-color: #10b981;
            color: white;
        }
        .error {
            background-color: #ef4444;
            color: white;
        }
        .preview-container {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            height: 600px;
            overflow-y: auto;
        }
        .github-login {
            background: linear-gradient(135deg, #24292e 0%, #2f363d 100%);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <div class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center">
                    <i class="fas fa-edit text-blue-600 text-2xl mr-3"></i>
                    <h1 class="text-2xl font-bold text-gray-900">Editor Portfolio - Francisco Medina</h1>
                </div>
                <div id="user-info" class="hidden flex items-center space-x-4">
                    <span id="username" class="text-gray-700"></span>
                    <button id="logout-btn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-md text-sm">
                        <i class="fas fa-sign-out-alt mr-2"></i>Cerrar Sesión
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Screen -->
    <div id="login-screen" class="min-h-screen flex items-center justify-center">
        <div class="max-w-md w-full space-y-8 p-8">
            <div class="text-center">
                <i class="fab fa-github text-6xl text-gray-800 mb-4"></i>
                <h2 class="text-3xl font-bold text-gray-900 mb-2">Conectar con GitHub</h2>
                <p class="text-gray-600 mb-8">Autoriza el acceso para editar tu portfolio directamente</p>
                
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <label class="block text-sm font-medium text-gray-700 mb-2">GitHub Personal Access Token</label>
                    <input type="password" id="github-token" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <p class="text-xs text-gray-500 mt-2">
                        <a href="https://github.com/settings/tokens/new?scopes=repo" target="_blank" class="text-blue-600 hover:underline">
                            Crear token con permisos 'repo'
                        </a>
                    </p>
                    
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Repositorio</label>
                        <input type="text" id="repo-name" value="misterbins/francisco-medina-portfolio" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    
                    <button id="connect-btn" class="w-full mt-6 github-login text-white font-semibold py-3 px-4 rounded-md hover:opacity-90 transition duration-300">
                        <i class="fab fa-github mr-2"></i>Conectar y Cargar Contenido
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Editor Screen -->
    <div id="editor-screen" class="hidden">
        <!-- Status Bar -->
        <div id="status-bar" class="bg-blue-50 border-b px-4 py-2">
            <div class="flex items-center justify-between max-w-7xl mx-auto">
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-gray-600">Estado:</span>
                    <span id="status-text" class="text-sm font-medium text-green-600">Conectado</span>
                    <span id="last-save" class="text-sm text-gray-500"></span>
                </div>
                <button id="save-all" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                    <i class="fas fa-save mr-2"></i>Guardar Todos los Cambios
                </button>
            </div>
        </div>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Editor Panel -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                        <i class="fas fa-edit mr-2 text-blue-600"></i>Editor de Contenido
                    </h2>
                    
                    <div class="space-y-6">
                        <!-- Información Personal -->
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h3 class="font-semibold text-gray-900 mb-3">Información Personal</h3>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Nombre Principal</label>
                                    <input type="text" id="main-title" class="editor-field w-full" value="Francisco Medina">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Subtítulo (ES)</label>
                                    <input type="text" id="subtitle-es" class="editor-field w-full" value="Senior Copywriter - Director Creativo">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Subtítulo (EN)</label>
                                    <input type="text" id="subtitle-en" class="editor-field w-full" value="Senior Copywriter - Creative Director">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Tagline (ES)</label>
                                    <input type="text" id="tagline-es" class="editor-field w-full" value="De redactor a director: Creatividad con visión estratégica">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Tagline (EN)</label>
                                    <input type="text" id="tagline-en" class="editor-field w-full" value="From copywriter to director: Creativity with strategic vision">
                                </div>
                            </div>
                        </div>

                        <!-- Evolución -->
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h3 class="font-semibold text-gray-900 mb-3">La Evolución / The Evolution</h3>
                            <div class="space-y-4">
                                <!-- Acto 1 -->
                                <div class="bg-white p-3 rounded border">
                                    <h4 class="font-medium mb-2">Acto 1: El Redactor / The Copywriter</h4>
                                    <textarea id="act1-desc-es" class="editor-field w-full h-20" placeholder="Descripción en español">Nací laboralmente como redactor publicitario. Aprendiendo el oficio, desarrollando la voz y entendiendo cómo las palabras pueden mover audiencias.</textarea>
                                    <textarea id="act1-desc-en" class="editor-field w-full h-20 mt-2" placeholder="Descripción en inglés">I was born professionally as an advertising copywriter. Learning the craft, developing voice and understanding how words can move audiences.</textarea>
                                </div>
                                
                                <!-- Acto 2 -->
                                <div class="bg-white p-3 rounded border">
                                    <h4 class="font-medium mb-2">Acto 2: El Estratega / The Strategist</h4>
                                    <textarea id="act2-desc-es" class="editor-field w-full h-20">Mutando hacia el mundo digital, adquiriendo nuevos conocimientos que complementan la escritura. Entendiendo el negocio detrás de cada pieza creativa.</textarea>
                                    <textarea id="act2-desc-en" class="editor-field w-full h-20 mt-2">Evolving into the digital world, acquiring new knowledge that complements writing. Understanding the business behind every creative piece.</textarea>
                                </div>
                                
                                <!-- Acto 3 -->
                                <div class="bg-white p-3 rounded border">
                                    <h4 class="font-medium mb-2">Acto 3: El Director / The Director</h4>
                                    <textarea id="act3-desc-es" class="editor-field w-full h-20">Liderando equipos creativos, dirigiendo estrategias que funcionan. Las habilidades blandas se convirtieron en mi superpoder para hacer que las ideas cobren vida.</textarea>
                                    <textarea id="act3-desc-en" class="editor-field w-full h-20 mt-2">Leading creative teams, directing strategies that work. Soft skills became my superpower to bring ideas to life.</textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Servicios -->
                        <div class="bg-green-50 p-4 rounded-lg">
                            <h3 class="font-semibold text-gray-900 mb-3">Mis Servicios</h3>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Servicio 1 - Título (ES/EN)</label>
                                    <div class="grid grid-cols-2 gap-2">
                                        <input type="text" id="service1-title-es" class="editor-field" value="Dirección Creativa">
                                        <input type="text" id="service1-title-en" class="editor-field" value="Creative Direction">
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Servicio 2 - Título (ES/EN)</label>
                                    <div class="grid grid-cols-2 gap-2">
                                        <input type="text" id="service2-title-es" class="editor-field" value="Estrategia Digital">
                                        <input type="text" id="service2-title-en" class="editor-field" value="Digital Strategy">
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Servicio 3 - Título (ES/EN)</label>
                                    <div class="grid grid-cols-2 gap-2">
                                        <input type="text" id="service3-title-es" class="editor-field" value="Consultoría">
                                        <input type="text" id="service3-title-en" class="editor-field" value="Consulting">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Auto-save Toggle -->
                        <div class="bg-yellow-50 p-4 rounded-lg">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h3 class="font-semibold text-gray-900">Guardado Automático</h3>
                                    <p class="text-sm text-gray-600">Los cambios se guardan automáticamente cada 30 segundos</p>
                                </div>
                                <label class="flex items-center">
                                    <input type="checkbox" id="auto-save" checked class="mr-2">
                                    <span class="text-sm">Activado</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Preview Panel -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-6 flex items-center">
                        <i class="fas fa-eye mr-2 text-green-600"></i>Vista Previa
                    </h2>
                    
                    <div class="mb-4 flex space-x-2">
                        <button id="preview-es" class="bg-blue-600 text-white px-3 py-1 rounded text-sm">Español</button>
                        <button id="preview-en" class="bg-gray-300 text-gray-700 px-3 py-1 rounded text-sm">English</button>
                        <button id="refresh-preview" class="bg-green-600 text-white px-3 py-1 rounded text-sm ml-auto">
                            <i class="fas fa-sync-alt mr-1"></i>Actualizar
                        </button>
                    </div>
                    
                    <div id="preview-frame" class="preview-container bg-gray-50 p-4">
                        <div class="text-center py-8">
                            <i class="fas fa-spinner fa-spin text-2xl text-gray-400"></i>
                            <p class="text-gray-500 mt-2">Cargando vista previa...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class GitHubPortfolioEditor {
            constructor() {
                this.token = localStorage.getItem('github_token');
                this.repo = localStorage.getItem('github_repo') || 'misterbins/francisco-medina-portfolio';
                this.autoSaveInterval = null;
                this.currentLanguage = 'es';
                
                this.init();
            }
            
            init() {
                this.bindEvents();
                
                if (this.token) {
                    this.showEditor();
                    this.loadContent();
                } else {
                    this.showLogin();
                }
            }
            
            bindEvents() {
                // Login events
                document.getElementById('connect-btn').addEventListener('click', () => this.connect());
                document.getElementById('logout-btn').addEventListener('click', () => this.logout());
                
                // Editor events
                document.getElementById('save-all').addEventListener('click', () => this.saveAllChanges());
                document.getElementById('auto-save').addEventListener('change', (e) => this.toggleAutoSave(e.target.checked));
                document.getElementById('refresh-preview').addEventListener('click', () => this.updatePreview());
                
                // Preview language toggle
                document.getElementById('preview-es').addEventListener('click', () => this.setPreviewLanguage('es'));
                document.getElementById('preview-en').addEventListener('click', () => this.setPreviewLanguage('en'));
                
                // Auto-update preview on input change
                document.querySelectorAll('.editor-field').forEach(field => {
                    field.addEventListener('input', () => {
                        clearTimeout(this.previewTimeout);
                        this.previewTimeout = setTimeout(() => this.updatePreview(), 1000);
                    });
                });
            }
            
            async connect() {
                const token = document.getElementById('github-token').value.trim();
                const repo = document.getElementById('repo-name').value.trim();
                
                if (!token || !repo) {
                    this.showStatus('Por favor completa todos los campos', 'error');
                    return;
                }
                
                try {
                    // Test the token
                    const response = await fetch(`https://api.github.com/repos/${repo}`, {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error('No se pudo acceder al repositorio. Verifica el token y el nombre del repositorio.');
                    }
                    
                    // Save credentials
                    localStorage.setItem('github_token', token);
                    localStorage.setItem('github_repo', repo);
                    
                    this.token = token;
                    this.repo = repo;
                    
                    this.showEditor();
                    await this.loadContent();
                    
                    this.showStatus('Conectado exitosamente', 'success');
                    
                } catch (error) {
                    this.showStatus(error.message, 'error');
                }
            }
            
            logout() {
                localStorage.removeItem('github_token');
                localStorage.removeItem('github_repo');
                this.token = null;
                this.repo = null;
                this.showLogin();
            }
            
            showLogin() {
                document.getElementById('login-screen').classList.remove('hidden');
                document.getElementById('editor-screen').classList.add('hidden');
            }
            
            showEditor() {
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('editor-screen').classList.remove('hidden');
                document.getElementById('user-info').classList.remove('hidden');
                
                // Start auto-save if enabled
                if (document.getElementById('auto-save').checked) {
                    this.startAutoSave();
                }
            }
            
            async loadContent() {
                try {
                    const response = await fetch(`https://api.github.com/repos/${this.repo}/contents/index.html`, {
                        headers: {
                            'Authorization': `token ${this.token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        const content = atob(data.content);
                        this.parseAndLoadContent(content);
                        this.showStatus('Contenido cargado exitosamente', 'success');
                    }
                    
                } catch (error) {
                    this.showStatus('Error al cargar contenido: ' + error.message, 'error');
                }
            }
            
            parseAndLoadContent(html) {
                // This is a simplified parser - in reality you'd want more robust parsing
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                
                // Extract content from the HTML and populate form fields
                // This is a basic implementation - you'd expand this based on your HTML structure
                
                this.updatePreview();
            }
            
            async saveAllChanges() {
                try {
                    this.showStatus('Guardando cambios...', 'saving');
                    
                    const updatedHTML = this.generateUpdatedHTML();
                    
                    // Get current file info
                    const fileResponse = await fetch(`https://api.github.com/repos/${this.repo}/contents/index.html`, {
                        headers: {
                            'Authorization': `token ${this.token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    const fileData = await fileResponse.json();
                    
                    // Update file
                    const updateResponse = await fetch(`https://api.github.com/repos/${this.repo}/contents/index.html`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${this.token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            message: 'Actualización del portfolio desde editor',
                            content: btoa(updatedHTML),
                            sha: fileData.sha
                        })
                    });
                    
                    if (updateResponse.ok) {
                        this.showStatus('Cambios guardados exitosamente', 'success');
                        const now = new Date().toLocaleString();
                        document.getElementById('last-save').textContent = `Último guardado: ${now}`;
                    } else {
                        throw new Error('Error al guardar cambios');
                    }
                    
                } catch (error) {
                    this.showStatus('Error al guardar: ' + error.message, 'error');
                }
            }
            
            generateUpdatedHTML() {
                // Generate the complete HTML with updated content
                // This would be a comprehensive function that takes all form values
                // and generates the complete HTML structure
                
                const title = document.getElementById('main-title').value;
                const subtitleES = document.getElementById('subtitle-es').value;
                const subtitleEN = document.getElementById('subtitle-en').value;
                
                // This is a simplified version - you'd want to generate the complete HTML
                return `<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${title} - Portfolio</title>
    <!-- Add your complete HTML structure here -->
</head>
<body>
    <h1>${title}</h1>
    <p class="subtitle-es">${subtitleES}</p>
    <p class="subtitle-en hidden">${subtitleEN}</p>
    <!-- Add complete portfolio structure -->
</body>
</html>`;
            }
            
            updatePreview() {
                const previewContent = this.generatePreviewContent();
                document.getElementById('preview-frame').innerHTML = previewContent;
            }
            
            generatePreviewContent() {
                const title = document.getElementById('main-title').value || 'Francisco Medina';
                const subtitle = this.currentLanguage === 'es' 
                    ? (document.getElementById('subtitle-es').value || 'Senior Copywriter - Director Creativo')
                    : (document.getElementById('subtitle-en').value || 'Senior Copywriter - Creative Director');
                
                return `
                    <div style="font-family: 'Playfair Display', serif; text-align: center; padding: 2rem;">
                        <h1 style="font-size: 3rem; margin-bottom: 1rem; color: #1a1a1a;">${title}</h1>
                        <p style="font-size: 1.2rem; color: #666; margin-bottom: 2rem;">${subtitle}</p>
                        <div style="text-align: left; max-width: 600px; margin: 0 auto;">
                            <h2 style="font-size: 2rem; margin: 2rem 0 1rem 0;">Vista Previa Simplificada</h2>
                            <p>Esta es una vista previa básica de tus cambios. El sitio real tendrá el diseño completo una vez guardado.</p>
                        </div>
                    </div>
                `;
            }
            
            setPreviewLanguage(lang) {
                this.currentLanguage = lang;
                
                // Update button states
                document.getElementById('preview-es').className = lang === 'es' 
                    ? 'bg-blue-600 text-white px-3 py-1 rounded text-sm'
                    : 'bg-gray-300 text-gray-700 px-3 py-1 rounded text-sm';
                    
                document.getElementById('preview-en').className = lang === 'en'
                    ? 'bg-blue-600 text-white px-3 py-1 rounded text-sm'
                    : 'bg-gray-300 text-gray-700 px-3 py-1 rounded text-sm';
                
                this.updatePreview();
            }
            
            toggleAutoSave(enabled) {
                if (enabled) {
                    this.startAutoSave();
                } else {
                    this.stopAutoSave();
                }
            }
            
            startAutoSave() {
                this.stopAutoSave(); // Clear any existing interval
                this.autoSaveInterval = setInterval(() => {
                    this.saveAllChanges();
                }, 30000); // Save every 30 seconds
            }
            
            stopAutoSave() {
                if (this.autoSaveInterval) {
                    clearInterval(this.autoSaveInterval);
                    this.autoSaveInterval = null;
                }
            }
            
            showStatus(message, type = 'info') {
                const statusText = document.getElementById('status-text');
                const statusBar = document.getElementById('status-bar');
                
                statusText.textContent = message;
                
                // Remove existing classes
                statusBar.className = 'border-b px-4 py-2';
                statusText.className = 'text-sm font-medium';
                
                // Add type-specific classes
                switch (type) {
                    case 'success':
                        statusBar.classList.add('bg-green-50');
                        statusText.classList.add('text-green-600');
                        break;
                    case 'error':
                        statusBar.classList.add('bg-red-50');
                        statusText.classList.add('text-red-600');
                        break;
                    case 'saving':
                        statusBar.classList.add('bg-yellow-50');
                        statusText.classList.add('text-yellow-600', 'saving');
                        break;
                    default:
                        statusBar.classList.add('bg-blue-50');
                        statusText.classList.add('text-blue-600');
                }
                
                // Auto-clear status after 5 seconds (except for saving)
                if (type !== 'saving') {
                    setTimeout(() => {
                        statusText.textContent = 'Conectado';
                        statusBar.className = 'bg-blue-50 border-b px-4 py-2';
                        statusText.className = 'text-sm font-medium text-green-600';
                    }, 5000);
                }
            }
        }
        
        // Initialize the editor when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new GitHubPortfolioEditor();
        });
    </script>
</body>
</html>
